---
import { Image, ImageOptions, PlaceholderOptions } from "astro-eleventy-img"

interface Props {
  src: string
  alt: string
  caption?: string
  options?: ImageOptions
  sizes?: string
  classes?: string
  quality?: number
  placeholderOptions?: PlaceholderOptions
}

const {
  src,
  alt,
  caption,
  options = {},
  sizes = "",
  classes = undefined,
  quality = 90,
  placeholderOptions = {},
} = Astro.props as Props

const url = new URL(Astro.request.url).pathname

// Due to an issue in Astro preventing us from using the /articles/ path (see [slug].astro in pages/article), we have
// to manually replace it in the URL so images can work. Hopefully won't be needed someday - erika, 2021-12-08
const tempURL = url.replace("/article/", "/articles/")
// If our URL starts with a slash, let's assume the user know what they're doing and not alter the URL apart from the content prefix
// The reason this is needed is for subarticles, even though they reside in the same folder as their parent, their path
// is not accurate to the file structure and so, looking the image relatively doesn't work - erika, 2021-12-08
const tempSrc = src.startsWith("/") ? "content" + src : "content" + tempURL + "/" + src

const props: Props = Object.assign(
  { ...Astro.props },
  {
    src: tempSrc,
    alt,
    options: {
      outputDir: "static/assets/images",
    },
  },
)
---

<Image {...props} />

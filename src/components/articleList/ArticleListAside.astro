---
import { blogFilter } from "$utils";
import { getCollection } from "astro:content";

interface Props {
	showAllButton?: boolean | undefined;
}

const articles = await getCollection("blog");
const tags: [string, number][] = [
	...articles
		.filter(blogFilter)
		.flatMap((article) => [...article.data.tags])
		.reduce((acc, e) => acc.set(e, (acc.get(e) || 0) + 1), new Map()),
].sort((a, b) => {
	return b[1] - a[1];
});

const years: [string, number][] = [
	...articles
		.filter(blogFilter)
		.map((article) => new Date(article.data.date).getUTCFullYear())
		.reduce((acc, e) => acc.set(e, (acc.get(e) || 0) + 1), new Map()),
].sort((a, b) => {
	return b[0] - a[0];
});

const { showAllButton } = Astro.props;
---

<aside class="grow-0 basis-1/5 sm:my-8">
	<div class="top-4 mt-4 flex flex-col items-center gap-y-6 sm:sticky sm:mt-0 sm:items-start">
		{
			showAllButton ? (
				<a
					class="inline w-fit bg-accent-valencia p-1 font-semibold text-white-sugar-cane hover:bg-white-sugar-cane hover:text-accent-valencia"
					href="/articles"
				>
					See all
				</a>
			) : (
        <></>
			)
		}
		<ul class="m-0 flex list-none flex-wrap justify-center gap-1 p-0 sm:justify-start">
			{
				tags.map((tag) => (
					<a class="button-style-bg-accent inline" href={"/articles/tags/" + tag[0] + "/"}>
						<li>{tag[0]}</li>
					</a>
				))
			}
		</ul>
		<ul class="m-0 flex list-none flex-wrap gap-1 p-0">
			{
				years.map((year) => (
					<a class="button-style-bg-accent inline" href={"/articles/years/" + year[0] + "/"}>
						<li>{year[0]}</li>
					</a>
				))
			}
		</ul>
	</div>
</aside>
